# Data Model Specification for Todo Full-Stack Web Application

## Entity Definitions

### Task Entity
**Description**: Represents a user's todo task

**Fields**:
- `id` (INTEGER, PRIMARY KEY, AUTO_INCREMENT)
  - Unique identifier for the task
  - Auto-generated by the database
- `user_id` (STRING/UUID, NOT NULL, FOREIGN KEY)
  - References the user who owns the task
  - Links to Better Auth user ID
  - Enforced by foreign key constraint
- `title` (STRING, NOT NULL, 1-200 characters)
  - Task title/description in short form
  - Required field
  - Validated to be 1-200 characters
- `description` (TEXT, OPTIONAL, 0-1000 characters)
  - Detailed description of the task
  - Optional field
  - Validated to be max 1000 characters
- `completed` (BOOLEAN, DEFAULT false)
  - Task completion status
  - Default value is false (pending)
  - Can be toggled between true/false
- `created_at` (TIMESTAMP, NOT NULL, DEFAULT CURRENT_TIMESTAMP)
  - Timestamp when task was created
  - Automatically set by database
  - Immutable after creation
- `updated_at` (TIMESTAMP, NOT NULL, DEFAULT CURRENT_TIMESTAMP)
  - Timestamp when task was last modified
  - Automatically updated on any modification
  - Used for tracking changes

**Relationships**:
- One-to-Many: User (Better Auth) → Tasks
- Each user can have multiple tasks
- Each task belongs to exactly one user

**Validation Rules**:
- Title must be 1-200 characters
- Description must be 0-1000 characters (if provided)
- user_id must reference a valid user
- completed must be boolean value
- created_at and updated_at are system-managed

**Indexes**:
- `idx_tasks_user_id`: Index on user_id for efficient user-based queries
- `idx_tasks_completed`: Index on completed for status-based queries
- `idx_tasks_created_at`: Index on created_at for time-based queries

### User Entity (Managed by Better Auth)
**Description**: User information managed by Better Auth system

**Fields** (as provided by Better Auth):
- `id` (STRING/UUID, PRIMARY KEY)
  - Unique user identifier
  - Generated by Better Auth
- `email` (STRING, NOT NULL, UNIQUE)
  - User's email address
  - Used for authentication
- `name` (STRING, OPTIONAL)
  - User's display name
- `image` (STRING, OPTIONAL)
  - URL to user's profile image
- `email_verified` (TIMESTAMP, OPTIONAL)
  - Timestamp when email was verified
- `created_at` (TIMESTAMP, NOT NULL)
  - Account creation timestamp
- `updated_at` (TIMESTAMP, NOT NULL)
  - Last update timestamp

**Relationships**:
- One-to-Many: User → Tasks
- Each user can own multiple tasks

## State Transitions

### Task State Transitions
```
PENDING (completed: false) ↔ COMPLETED (completed: true)
```

**Transition Rules**:
- Task can be created in PENDING state only
- Task status can be toggled between PENDING and COMPLETED
- No other states are defined (binary completion model)

## Data Validation

### Input Validation
- **Title**:
  - Required field
  - 1-200 characters
  - Trimmed of leading/trailing whitespace
  - Sanitized to prevent XSS

- **Description**:
  - Optional field
  - 0-1000 characters (if provided)
  - Sanitized to prevent XSS

- **User ID**:
  - Must match authenticated user's ID
  - Must reference existing user in Better Auth system
  - Verified through JWT token validation

### Database Constraints
- Foreign key constraint: tasks.user_id → users.id
- Check constraint: title length (1-200 characters)
- Check constraint: description length (≤1000 characters)
- Not null constraints on required fields

## API Data Contracts

### Request/Response Objects

#### Task Creation Request
```json
{
  "title": "Task title (1-200 chars)",
  "description": "Optional description (≤1000 chars)"
}
```

#### Task Response Object
```json
{
  "id": 123,
  "user_id": "user-uuid",
  "title": "Task title",
  "description": "Task description",
  "completed": false,
  "created_at": "2026-01-01T10:00:00Z",
  "updated_at": "2026-01-01T10:00:00Z"
}
```

#### Task Update Request
```json
{
  "title": "Updated task title (1-200 chars)",
  "description": "Updated description (≤1000 chars)"
}
```

#### Task Completion Toggle Request
```json
{
  "completed": true
}
```

## Security Considerations

### Data Isolation
- Foreign key constraints ensure referential integrity
- Application-level checks verify user_id matches authenticated user
- All queries are filtered by user_id to prevent unauthorized access

### Data Validation
- Input validation at API layer using Pydantic models
- Database constraints enforce data integrity
- Proper escaping prevents SQL injection
- XSS prevention through input sanitization

### Access Control
- All operations require valid JWT token
- User ID in token must match user ID in request
- Database queries always filter by user_id
- No direct access to other users' data

## Performance Considerations

### Indexing Strategy
- Primary indexes on foreign keys (user_id) for fast JOINs and filtering
- Indexes on frequently queried columns (completed, created_at)
- Consider composite indexes for common query patterns if needed

### Query Optimization
- Always filter by user_id to leverage idx_tasks_user_id
- Use appropriate indexes for sorting operations
- Limit result sets with pagination for large datasets

### Storage Efficiency
- Use appropriate data types for storage optimization
- TEXT field for description allows flexible length
- BOOLEAN field for completion status is storage-efficient

## Migration Strategy

### Initial Schema Creation
```sql
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    user_id TEXT NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE
);

CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_completed ON tasks(completed);
CREATE INDEX idx_tasks_created_at ON tasks(created_at);

ALTER TABLE tasks
ADD CONSTRAINT chk_tasks_title_length
CHECK (LENGTH(title) >= 1 AND LENGTH(title) <= 200);

ALTER TABLE tasks
ADD CONSTRAINT chk_tasks_description_length
CHECK (LENGTH(description) <= 1000);
```

### Future Migrations
- Use Alembic for Python-based migration management
- Maintain backward compatibility when possible
- Test migrations on staging before production deployment
- Backup database before running migrations

## Backup and Recovery
- Automated daily backups of the database
- Point-in-time recovery capability
- Regular backup verification and restoration testing
- Retention policy: 30 days of daily backups, 12 months of monthly backups